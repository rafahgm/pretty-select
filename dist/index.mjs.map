{"version":3,"sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Adiciona um evento a um elemento HTML\r\n * @param elemento \r\n * @param tipoEvento \r\n * @param callback \r\n * @param options \r\n */\r\nexport function addEvento(\r\n    elemento: HTMLElement,\r\n    tipoEvento: keyof HTMLElementEventMap,\r\n    callback: EventListenerOrEventListenerObject,\r\n    options?: Object\r\n): void {\r\n    elemento.addEventListener(tipoEvento, callback);\r\n}","import { addEvento } from \"./utils\";\r\n\r\ndeclare global {\r\n    interface Window { Select: any; }\r\n}\r\n\r\nclass Select {\r\n    private elemento?: HTMLSelectElement;\r\n    private opcoes: Array<Opcao> = [];\r\n\r\n    // DOM do Select\r\n    private wrapper: HTMLDivElement = document.createElement('div');;\r\n    private controle: HTMLDivElement = document.createElement('div');\r\n    private pesquisa: HTMLInputElement = document.createElement('input');\r\n    private opcoesContainer: HTMLDivElement = document.createElement('div');\r\n\r\n    // Estado\r\n    private aberto: boolean = false;\r\n\r\n    constructor(elemento: HTMLSelectElement | string, opcoes: OpcoesSelect) {\r\n        if (typeof (elemento) === \"string\" && document.querySelector(elemento)) {\r\n            this.elemento = document.querySelector(elemento) as HTMLSelectElement;\r\n        } else if (elemento instanceof HTMLSelectElement) {\r\n            this.elemento = elemento;\r\n        } else {\r\n            throw new Error('elemento precisa ser um HTMLSelectElement ou um seletor CSS');\r\n        }\r\n\r\n        // Esconde select original\r\n        this.elemento.classList.add('select--escondido');\r\n\r\n        // Verifica se o select original possui opções\r\n        [...this.elemento.options].forEach(opcao => {\r\n            this.opcoes.push({\r\n                valor: opcao.value,\r\n                texto: opcao.label\r\n            });\r\n        })\r\n\r\n        // Cria HTML do Select\r\n        this.geraDOMSelect(opcoes.placeholder ?? ' ');\r\n\r\n        // Configura eventos\r\n        addEvento(this.controle, 'mousedown', (e) => this.onControleClick(e as MouseEvent));\r\n    \r\n        addEvento(this.pesquisa, 'keydown', function (event) {\r\n            const key = (event as KeyboardEvent).key;\r\n\r\n            switch (key) {\r\n                case 'ArrowUp':\r\n                case 'ArrowDown': {\r\n                    const opcaoAtiva = document.querySelector<HTMLSpanElement>('.select__dropdown span.ativo');\r\n\r\n                    let novaOpcaoSelecionada = key === 'ArrowUp' ? opcaoAtiva?.previousElementSibling : opcaoAtiva?.nextElementSibling;\r\n\r\n                    if (novaOpcaoSelecionada) {\r\n                        opcaoAtiva?.classList.remove('ativo');\r\n                        novaOpcaoSelecionada.classList.add('ativo');\r\n                    }\r\n\r\n                } break;\r\n            }\r\n        });\r\n\r\n        this.pesquisa.addEventListener('keyup', function (event) {\r\n            const key = (event as KeyboardEvent).key;\r\n\r\n            let opcoesEncontradas = 0;\r\n\r\n            // Remove o texto de nada encontrado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span[data-nada]\").forEach(span => {\r\n                span.remove();\r\n            });\r\n\r\n            // Percorre pelas opções procurando o texto digitado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span\").forEach(opcao => {\r\n                if (this.value.length > 0) {\r\n                    const stringOriginal = opcao.textContent ?? '';\r\n                    const stringNormalizada = stringOriginal.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n                    const pesquisaNormalizada = this.value.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n\r\n                    const index = stringNormalizada.toUpperCase().indexOf(pesquisaNormalizada.toUpperCase());\r\n\r\n                    if (pesquisaNormalizada.length === 0) {\r\n                        // Restaura os textos\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n\r\n                    if (index > -1) {\r\n                        opcao.style.display = \"inline-block\";\r\n\r\n                        //Substitui o conteudo do span pelo highlight\r\n                        const token = stringOriginal.slice(index, index + this.value.length);\r\n                        const depois = stringOriginal.slice(stringOriginal.indexOf(token) + this.value.length);\r\n                        const antes = stringOriginal.slice(0, stringOriginal.indexOf(token));\r\n                        opcao.innerHTML = antes + `<mark>${token}</mark>` + depois;\r\n                        opcoesEncontradas++;\r\n                    } else {\r\n                        opcao.style.display = \"none\";\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n                } else {\r\n                    // Restaura todos\r\n                    opcao.style.display = 'inline-block';\r\n                    opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                }\r\n            });\r\n\r\n            if (opcoesEncontradas === 0 && this.value.length > 0) {\r\n                document.querySelector(\".select__dropdown\")?.insertAdjacentHTML('beforeend', '<span data-nada>Nenhuma opção encontrada</span>');\r\n            }\r\n\r\n        })\r\n\r\n        addEvento(this.pesquisa, 'focus', (e) => this.onPesquisaFocus(e as FocusEvent));\r\n        \r\n        addEvento(this.pesquisa, 'focusout', () => {\r\n            this.fecharOpcoes();\r\n        });\r\n    }\r\n\r\n    private geraDOMSelect(pesquisaPlaceholder: string): void {\r\n        // Wrapper\r\n        this.wrapper.classList.add('select__wrapper');\r\n\r\n        // Controle\r\n        this.controle.classList.add('select__controle');\r\n\r\n        // Pesquisa\r\n        this.pesquisa.setAttribute('type', 'text');\r\n        this.pesquisa.setAttribute('spellcheck', 'false');\r\n        this.pesquisa.setAttribute('placeholder', pesquisaPlaceholder);\r\n        this.pesquisa.setAttribute('autocomplete', 'off');\r\n        this.pesquisa.setAttribute('tabindex', '0');\r\n        this.pesquisa.setAttribute('role', 'combobox');\r\n        this.pesquisa.classList.add('select__controle__pesquisa');\r\n        this.pesquisa.id = \"select-pesquisa\";\r\n\r\n        this.controle.appendChild(this.pesquisa);\r\n        this.wrapper.appendChild(this.controle);\r\n\r\n        // Opcoes\r\n        this.opcoesContainer.classList.add('select__dropdown');\r\n        this.opcoesContainer.style.display = 'none';\r\n        this.geraDOMOpcoes(this.opcoesContainer);\r\n        this.wrapper.appendChild(this.opcoesContainer);\r\n       \r\n        this.elemento?.insertAdjacentElement('afterend', this.wrapper);\r\n    }\r\n\r\n    private geraDOMOpcoes(opcoesContainer: HTMLDivElement): void {\r\n\r\n        this.opcoes.forEach((opcao, index) => {\r\n            const span = document.createElement('span');\r\n            span.dataset.valor = opcao.valor;\r\n            span.dataset.texto = opcao.texto;\r\n            span.textContent = opcao.texto;\r\n\r\n            span.addEventListener('mouseover', function () {\r\n                const todasOpcoes = this.parentElement?.children ?? [];\r\n\r\n                // Limpa todos as outras opções\r\n                for (let i = 0; i < todasOpcoes.length; i++) todasOpcoes[i]?.classList.remove('ativo');\r\n\r\n                // Marca a opção atual como ativa\r\n                this.classList.add('ativo');\r\n            });\r\n\r\n            if(index === 0) span.classList.add('ativo');\r\n\r\n            opcoesContainer.append(span);\r\n        });\r\n    }\r\n\r\n    private fecharOpcoes() {\r\n        this.wrapper.classList.remove('focado');\r\n        this.opcoesContainer.style.display = 'none';\r\n        this.pesquisa.blur();\r\n        this.aberto = false;\r\n        this.pesquisa.value = '';\r\n    }\r\n\r\n    private abrirOpcoes() {\r\n        this.wrapper.classList.add('focado');\r\n        this.opcoesContainer.style.display = 'flex';\r\n        this.pesquisa.focus();\r\n        this.aberto = true;\r\n    }\r\n\r\n\r\n    private onPesquisaFocus(evento: FocusEvent) {\r\n        this.abrirOpcoes();\r\n    }\r\n\r\n    private onControleClick(evento: MouseEvent) {\r\n        evento.preventDefault();\r\n\r\n        if(this.pesquisa.value.length) return;\r\n\r\n        if(this.aberto) {\r\n            // Se está aberto, FECHAR\r\n            this.fecharOpcoes();\r\n            \r\n        }else {\r\n            // Se está fechado, ABRIR\r\n            this.abrirOpcoes();\r\n        }\r\n    }\r\n}\r\n\r\nwindow.Select = Select;\r\nexport default Select;"],"mappings":"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","names":["_a"]}