{"version":3,"sources":["../src/index.ts"],"sourcesContent":["declare global {\r\n    interface Window { Select: any; }\r\n}\r\n\r\nclass Select {\r\n    elemento?: HTMLSelectElement;\r\n    opcoes: Array<Opcao> = [];\r\n\r\n    constructor(elemento: HTMLSelectElement | string, opcoes: OpcoesSelect) {\r\n        if (typeof (elemento) === \"string\" && document.querySelector(elemento)) {\r\n            this.elemento = document.querySelector(elemento) as HTMLSelectElement;\r\n        } else if (elemento instanceof HTMLSelectElement) {\r\n            this.elemento = elemento;\r\n        } else {\r\n            throw new Error('elemento precisa ser um HTMLSelectElement ou um seletor CSS');\r\n        }\r\n\r\n        // Esconde select original\r\n        this.elemento.classList.add('select--escondido');\r\n\r\n        // Verifica se o select original possui opções\r\n        [...this.elemento.options].forEach(opcao => {\r\n            this.opcoes.push({\r\n                valor: opcao.value,\r\n                texto: opcao.label\r\n            });\r\n        })\r\n\r\n\r\n        this.elemento.insertAdjacentHTML('afterend', `<div class=\"select__wrapper\">\r\n        <div class=\"select__controle\">\r\n            <input type=\"text\" class=\"select__controle__pesquisa\" spellcheck=\"false\" placeholder=\"${opcoes.placeholder ?? \" \"}\" autocomplete=\"off\" tabindex=\"0\" role=\"combobox\" id=\"select-pesquisa\" />\r\n        </div>\r\n        <div class=\"select__dropdown\">\r\n        ${this.geraHTMLOpcoes()}\r\n        </div>\r\n        </div>`);\r\n\r\n        // Configura eventos\r\n\r\n        document.querySelector<HTMLInputElement>('#select-pesquisa')?.addEventListener('input', function () {\r\n            let opcoesEncontradas = 0;\r\n            \r\n            // Remove o texto de nada encontrado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span[data-nada]\").forEach(span => {\r\n                span.remove();\r\n            });\r\n\r\n            // Percorre pelas opções procurando o texto digitado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span\").forEach(opcao => {\r\n                if(this.value.length > 0) {\r\n                    const stringOriginal = opcao.textContent ?? '';\r\n                    const stringNormalizada = stringOriginal.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n                    const pesquisaNormalizada = this.value.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n    \r\n                    const index = stringNormalizada.toUpperCase().indexOf(pesquisaNormalizada.toUpperCase());\r\n    \r\n                    if (pesquisaNormalizada.length === 0) {\r\n                        // Restaura os textos\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n        \r\n                    if (index > -1) {\r\n                        opcao.style.display = \"inline-block\";\r\n    \r\n                        //Substitui o conteudo do span pelo highlight\r\n                        const token = stringOriginal.slice(index, index + this.value.length);\r\n                        const depois = stringOriginal.slice(stringOriginal.indexOf(token) + this.value.length);\r\n                        const antes = stringOriginal.slice(0, stringOriginal.indexOf(token));\r\n                        console.log({antes, depois});\r\n                        opcao.innerHTML = antes + `<mark>${token}</mark>` + depois;\r\n                        opcoesEncontradas++;\r\n                    } else {\r\n                        opcao.style.display = \"none\";\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n                }else {\r\n                    // Restaura todos\r\n                    opcao.style.display = 'inline-block';\r\n                    opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                }\r\n            });\r\n\r\n            if(opcoesEncontradas === 0 && this.value.length > 0) {\r\n                document.querySelector(\".select__dropdown\")?.insertAdjacentHTML('beforeend', '<span data-nada>Nenhuma opção encontrada</span>');\r\n            } \r\n        })\r\n    }\r\n\r\n    private geraHTMLOpcoes(): string {\r\n        let html = '';\r\n        this.opcoes.forEach(opcao => {\r\n            html += `<span data-valor=\"${opcao.valor}\" data-texto=\"${opcao.texto}\">${opcao.texto}</span>`\r\n        });\r\n\r\n        return html;\r\n    }\r\n}\r\n\r\nwindow.Select = Select;\r\nexport default Select;"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA,IAAM,SAAN,MAAa;AAAA,EAIT,YAAY,UAAsC,QAAsB;AAFxE,kBAAuB,CAAC;AAN5B;AASQ,QAAI,OAAQ,aAAc,YAAY,SAAS,cAAc,QAAQ,GAAG;AACpE,WAAK,WAAW,SAAS,cAAc,QAAQ;AAAA,IACnD,WAAW,oBAAoB,mBAAmB;AAC9C,WAAK,WAAW;AAAA,IACpB,OAAO;AACH,YAAM,IAAI,MAAM,6DAA6D;AAAA,IACjF;AAGA,SAAK,SAAS,UAAU,IAAI,mBAAmB;AAG/C,KAAC,GAAG,KAAK,SAAS,OAAO,EAAE,QAAQ,WAAS;AACxC,WAAK,OAAO,KAAK;AAAA,QACb,OAAO,MAAM;AAAA,QACb,OAAO,MAAM;AAAA,MACjB,CAAC;AAAA,IACL,CAAC;AAGD,SAAK,SAAS,mBAAmB,YAAY;AAAA;AAAA,qGAE+C,YAAO,gBAAP,YAAsB,GAAG;AAAA;AAAA;AAAA,UAGnH,KAAK,eAAe,CAAC;AAAA;AAAA,eAEhB;AAIP,mBAAS,cAAgC,kBAAkB,MAA3D,mBAA8D,iBAAiB,SAAS,WAAY;AAxC5G,UAAAA;AAyCY,UAAI,oBAAoB;AAGxB,eAAS,iBAAkC,mCAAmC,EAAE,QAAQ,UAAQ;AAC5F,aAAK,OAAO;AAAA,MAChB,CAAC;AAGD,eAAS,iBAAkC,wBAAwB,EAAE,QAAQ,WAAS;AAjDlG,YAAAA,KAAAC,KAAA;AAkDgB,YAAG,KAAK,MAAM,SAAS,GAAG;AACtB,gBAAM,kBAAiBD,MAAA,MAAM,gBAAN,OAAAA,MAAqB;AAC5C,gBAAM,oBAAoB,eAAe,UAAU,KAAK,EAAE,QAAQ,WAAC,kBAAc,IAAE,GAAE,EAAE;AACvF,gBAAM,sBAAsB,KAAK,MAAM,UAAU,KAAK,EAAE,QAAQ,WAAC,kBAAc,IAAE,GAAE,EAAE;AAErF,gBAAM,QAAQ,kBAAkB,YAAY,EAAE,QAAQ,oBAAoB,YAAY,CAAC;AAEvF,cAAI,oBAAoB,WAAW,GAAG;AAElC,kBAAM,aAAYC,MAAA,MAAM,QAAQ,UAAd,OAAAA,MAAuB;AAAA,UAC7C;AAEA,cAAI,QAAQ,IAAI;AACZ,kBAAM,MAAM,UAAU;AAGtB,kBAAM,QAAQ,eAAe,MAAM,OAAO,QAAQ,KAAK,MAAM,MAAM;AACnE,kBAAM,SAAS,eAAe,MAAM,eAAe,QAAQ,KAAK,IAAI,KAAK,MAAM,MAAM;AACrF,kBAAM,QAAQ,eAAe,MAAM,GAAG,eAAe,QAAQ,KAAK,CAAC;AACnE,oBAAQ,IAAI,EAAC,OAAO,OAAM,CAAC;AAC3B,kBAAM,YAAY,QAAQ,SAAS,KAAK,YAAY;AACpD;AAAA,UACJ,OAAO;AACH,kBAAM,MAAM,UAAU;AACtB,kBAAM,aAAY,WAAM,QAAQ,UAAd,YAAuB;AAAA,UAC7C;AAAA,QACJ,OAAM;AAEF,gBAAM,MAAM,UAAU;AACtB,gBAAM,aAAY,WAAM,QAAQ,UAAd,YAAuB;AAAA,QAC7C;AAAA,MACJ,CAAC;AAED,UAAG,sBAAsB,KAAK,KAAK,MAAM,SAAS,GAAG;AACjD,SAAAD,MAAA,SAAS,cAAc,mBAAmB,MAA1C,gBAAAA,IAA6C,mBAAmB,aAAa;AAAA,MACjF;AAAA,IACJ;AAAA,EACJ;AAAA,EAEQ,iBAAyB;AAC7B,QAAI,OAAO;AACX,SAAK,OAAO,QAAQ,WAAS;AACzB,cAAQ,qBAAqB,MAAM,KAAK,iBAAiB,MAAM,KAAK,KAAK,MAAM,KAAK;AAAA,IACxF,CAAC;AAED,WAAO;AAAA,EACX;AACJ;AAEA,OAAO,SAAS;AAChB,IAAO,cAAQ;","names":["_a","_b"]}