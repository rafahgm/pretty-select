{"version":3,"sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["/**\r\n * Adiciona um evento a um elemento HTML\r\n * @param elemento \r\n * @param tipoEvento \r\n * @param callback \r\n * @param options \r\n */\r\nexport function addEvento(\r\n    elemento: HTMLElement,\r\n    tipoEvento: keyof HTMLElementEventMap,\r\n    callback: EventListenerOrEventListenerObject,\r\n    options?: Object\r\n): void {\r\n    elemento.addEventListener(tipoEvento, callback);\r\n}","import { addEvento } from \"./utils\";\r\n\r\ndeclare global {\r\n    interface Window { Select: any; }\r\n}\r\n\r\nclass Select {\r\n    private elemento?: HTMLSelectElement;\r\n    private opcoes: Array<Opcao> = [];\r\n\r\n    // DOM do Select\r\n    private wrapper: HTMLDivElement = document.createElement('div');;\r\n    private controle: HTMLDivElement = document.createElement('div');\r\n    private pesquisa: HTMLInputElement = document.createElement('input');\r\n    private opcoesContainer: HTMLDivElement = document.createElement('div');\r\n\r\n    // Estado\r\n    private aberto: boolean = false;\r\n\r\n    constructor(elemento: HTMLSelectElement | string, opcoes: OpcoesSelect) {\r\n        if (typeof (elemento) === \"string\" && document.querySelector(elemento)) {\r\n            this.elemento = document.querySelector(elemento) as HTMLSelectElement;\r\n        } else if (elemento instanceof HTMLSelectElement) {\r\n            this.elemento = elemento;\r\n        } else {\r\n            throw new Error('elemento precisa ser um HTMLSelectElement ou um seletor CSS');\r\n        }\r\n\r\n        // Esconde select original\r\n        this.elemento.classList.add('select--escondido');\r\n\r\n        // Verifica se o select original possui opções\r\n        [...this.elemento.options].forEach(opcao => {\r\n            this.opcoes.push({\r\n                valor: opcao.value,\r\n                texto: opcao.label\r\n            });\r\n        })\r\n\r\n        // Cria HTML do Select\r\n        this.geraDOMSelect(opcoes.placeholder ?? ' ');\r\n\r\n        // Configura eventos\r\n        addEvento(this.controle, 'mousedown', (e) => this.onControleClick(e as MouseEvent));\r\n    \r\n        addEvento(this.pesquisa, 'keydown', function (event) {\r\n            const key = (event as KeyboardEvent).key;\r\n\r\n            switch (key) {\r\n                case 'ArrowUp':\r\n                case 'ArrowDown': {\r\n                    const opcaoAtiva = document.querySelector<HTMLSpanElement>('.select__dropdown span.ativo');\r\n\r\n                    let novaOpcaoSelecionada = key === 'ArrowUp' ? opcaoAtiva?.previousElementSibling : opcaoAtiva?.nextElementSibling;\r\n\r\n                    if (novaOpcaoSelecionada) {\r\n                        opcaoAtiva?.classList.remove('ativo');\r\n                        novaOpcaoSelecionada.classList.add('ativo');\r\n                    }\r\n\r\n                } break;\r\n            }\r\n        });\r\n\r\n        this.pesquisa.addEventListener('keyup', function (event) {\r\n            const key = (event as KeyboardEvent).key;\r\n\r\n            let opcoesEncontradas = 0;\r\n\r\n            // Remove o texto de nada encontrado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span[data-nada]\").forEach(span => {\r\n                span.remove();\r\n            });\r\n\r\n            // Percorre pelas opções procurando o texto digitado\r\n            document.querySelectorAll<HTMLSpanElement>(\".select__dropdown span\").forEach(opcao => {\r\n                if (this.value.length > 0) {\r\n                    const stringOriginal = opcao.textContent ?? '';\r\n                    const stringNormalizada = stringOriginal.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n                    const pesquisaNormalizada = this.value.normalize('NFD').replace(/\\p{Diacritic}/gu, '');\r\n\r\n                    const index = stringNormalizada.toUpperCase().indexOf(pesquisaNormalizada.toUpperCase());\r\n\r\n                    if (pesquisaNormalizada.length === 0) {\r\n                        // Restaura os textos\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n\r\n                    if (index > -1) {\r\n                        opcao.style.display = \"inline-block\";\r\n\r\n                        //Substitui o conteudo do span pelo highlight\r\n                        const token = stringOriginal.slice(index, index + this.value.length);\r\n                        const depois = stringOriginal.slice(stringOriginal.indexOf(token) + this.value.length);\r\n                        const antes = stringOriginal.slice(0, stringOriginal.indexOf(token));\r\n                        opcao.innerHTML = antes + `<mark>${token}</mark>` + depois;\r\n                        opcoesEncontradas++;\r\n                    } else {\r\n                        opcao.style.display = \"none\";\r\n                        opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                    }\r\n                } else {\r\n                    // Restaura todos\r\n                    opcao.style.display = 'inline-block';\r\n                    opcao.innerHTML = opcao.dataset.texto ?? '';\r\n                }\r\n            });\r\n\r\n            if (opcoesEncontradas === 0 && this.value.length > 0) {\r\n                document.querySelector(\".select__dropdown\")?.insertAdjacentHTML('beforeend', '<span data-nada>Nenhuma opção encontrada</span>');\r\n            }\r\n\r\n        })\r\n\r\n        addEvento(this.pesquisa, 'focus', (e) => this.onPesquisaFocus(e as FocusEvent));\r\n        \r\n        addEvento(this.pesquisa, 'focusout', () => {\r\n            this.fecharOpcoes();\r\n        });\r\n    }\r\n\r\n    private geraDOMSelect(pesquisaPlaceholder: string): void {\r\n        // Wrapper\r\n        this.wrapper.classList.add('select__wrapper');\r\n\r\n        // Controle\r\n        this.controle.classList.add('select__controle');\r\n\r\n        // Pesquisa\r\n        this.pesquisa.setAttribute('type', 'text');\r\n        this.pesquisa.setAttribute('spellcheck', 'false');\r\n        this.pesquisa.setAttribute('placeholder', pesquisaPlaceholder);\r\n        this.pesquisa.setAttribute('autocomplete', 'off');\r\n        this.pesquisa.setAttribute('tabindex', '0');\r\n        this.pesquisa.setAttribute('role', 'combobox');\r\n        this.pesquisa.classList.add('select__controle__pesquisa');\r\n        this.pesquisa.id = \"select-pesquisa\";\r\n\r\n        this.controle.appendChild(this.pesquisa);\r\n        this.wrapper.appendChild(this.controle);\r\n\r\n        // Opcoes\r\n        this.opcoesContainer.classList.add('select__dropdown');\r\n        this.opcoesContainer.style.display = 'none';\r\n        this.geraDOMOpcoes(this.opcoesContainer);\r\n        this.wrapper.appendChild(this.opcoesContainer);\r\n       \r\n        this.elemento?.insertAdjacentElement('afterend', this.wrapper);\r\n    }\r\n\r\n    private geraDOMOpcoes(opcoesContainer: HTMLDivElement): void {\r\n\r\n        this.opcoes.forEach((opcao, index) => {\r\n            const span = document.createElement('span');\r\n            span.dataset.valor = opcao.valor;\r\n            span.dataset.texto = opcao.texto;\r\n            span.textContent = opcao.texto;\r\n\r\n            span.addEventListener('mouseover', function () {\r\n                const todasOpcoes = this.parentElement?.children ?? [];\r\n\r\n                // Limpa todos as outras opções\r\n                for (let i = 0; i < todasOpcoes.length; i++) todasOpcoes[i]?.classList.remove('ativo');\r\n\r\n                // Marca a opção atual como ativa\r\n                this.classList.add('ativo');\r\n            });\r\n\r\n            if(index === 0) span.classList.add('ativo');\r\n\r\n            opcoesContainer.append(span);\r\n        });\r\n    }\r\n\r\n    private fecharOpcoes() {\r\n        this.wrapper.classList.remove('focado');\r\n        this.opcoesContainer.style.display = 'none';\r\n        this.pesquisa.blur();\r\n        this.aberto = false;\r\n        this.pesquisa.value = '';\r\n    }\r\n\r\n    private abrirOpcoes() {\r\n        this.wrapper.classList.add('focado');\r\n        this.opcoesContainer.style.display = 'flex';\r\n        this.pesquisa.focus();\r\n        this.aberto = true;\r\n    }\r\n\r\n\r\n    private onPesquisaFocus(evento: FocusEvent) {\r\n        this.abrirOpcoes();\r\n    }\r\n\r\n    private onControleClick(evento: MouseEvent) {\r\n        evento.preventDefault();\r\n\r\n        if(this.pesquisa.value.length) return;\r\n\r\n        if(this.aberto) {\r\n            // Se está aberto, FECHAR\r\n            this.fecharOpcoes();\r\n            \r\n        }else {\r\n            // Se está fechado, ABRIR\r\n            this.abrirOpcoes();\r\n        }\r\n    }\r\n}\r\n\r\nwindow.Select = Select;\r\nexport default Select;"],"mappings":";;;;AAOO,WAAS,UACZ,UACA,YACA,UACA,SACI;AACJ,aAAS,iBAAiB,YAAY,QAAQ;AAAA,EAClD;;;ACRA,MAAM,SAAN,MAAa;AAAA,IAaT,YAAY,UAAsC,QAAsB;AAXxE,WAAQ,SAAuB,CAAC;AAGhC;AAAA,WAAQ,UAA0B,SAAS,cAAc,KAAK;AAC9D,WAAQ,WAA2B,SAAS,cAAc,KAAK;AAC/D,WAAQ,WAA6B,SAAS,cAAc,OAAO;AACnE,WAAQ,kBAAkC,SAAS,cAAc,KAAK;AAGtE;AAAA,WAAQ,SAAkB;AAjB9B;AAoBQ,UAAI,OAAQ,aAAc,YAAY,SAAS,cAAc,QAAQ,GAAG;AACpE,aAAK,WAAW,SAAS,cAAc,QAAQ;AAAA,MACnD,WAAW,oBAAoB,mBAAmB;AAC9C,aAAK,WAAW;AAAA,MACpB,OAAO;AACH,cAAM,IAAI,MAAM,6DAA6D;AAAA,MACjF;AAGA,WAAK,SAAS,UAAU,IAAI,mBAAmB;AAG/C,OAAC,GAAG,KAAK,SAAS,OAAO,EAAE,QAAQ,WAAS;AACxC,aAAK,OAAO,KAAK;AAAA,UACb,OAAO,MAAM;AAAA,UACb,OAAO,MAAM;AAAA,QACjB,CAAC;AAAA,MACL,CAAC;AAGD,WAAK,eAAc,YAAO,gBAAP,YAAsB,GAAG;AAG5C,gBAAU,KAAK,UAAU,aAAa,CAAC,MAAM,KAAK,gBAAgB,CAAe,CAAC;AAElF,gBAAU,KAAK,UAAU,WAAW,SAAU,OAAO;AACjD,cAAM,MAAO,MAAwB;AAErC,gBAAQ,KAAK;AAAA,UACT,KAAK;AAAA,UACL,KAAK;AAAa;AACd,oBAAM,aAAa,SAAS,cAA+B,8BAA8B;AAEzF,kBAAI,uBAAuB,QAAQ,YAAY,yCAAY,yBAAyB,yCAAY;AAEhG,kBAAI,sBAAsB;AACtB,yDAAY,UAAU,OAAO;AAC7B,qCAAqB,UAAU,IAAI,OAAO;AAAA,cAC9C;AAAA,YAEJ;AAAE;AAAA,QACN;AAAA,MACJ,CAAC;AAED,WAAK,SAAS,iBAAiB,SAAS,SAAU,OAAO;AAhEjE,YAAAA;AAiEY,cAAM,MAAO,MAAwB;AAErC,YAAI,oBAAoB;AAGxB,iBAAS,iBAAkC,mCAAmC,EAAE,QAAQ,UAAQ;AAC5F,eAAK,OAAO;AAAA,QAChB,CAAC;AAGD,iBAAS,iBAAkC,wBAAwB,EAAE,QAAQ,WAAS;AA3ElG,cAAAA,KAAA;AA4EgB,cAAI,KAAK,MAAM,SAAS,GAAG;AACvB,kBAAM,kBAAiBA,MAAA,MAAM,gBAAN,OAAAA,MAAqB;AAC5C,kBAAM,oBAAoB,eAAe,UAAU,KAAK,EAAE,QAAQ,WAAC,kBAAc,IAAE,GAAE,EAAE;AACvF,kBAAM,sBAAsB,KAAK,MAAM,UAAU,KAAK,EAAE,QAAQ,WAAC,kBAAc,IAAE,GAAE,EAAE;AAErF,kBAAM,QAAQ,kBAAkB,YAAY,EAAE,QAAQ,oBAAoB,YAAY,CAAC;AAEvF,gBAAI,oBAAoB,WAAW,GAAG;AAElC,oBAAM,aAAY,WAAM,QAAQ,UAAd,YAAuB;AAAA,YAC7C;AAEA,gBAAI,QAAQ,IAAI;AACZ,oBAAM,MAAM,UAAU;AAGtB,oBAAM,QAAQ,eAAe,MAAM,OAAO,QAAQ,KAAK,MAAM,MAAM;AACnE,oBAAM,SAAS,eAAe,MAAM,eAAe,QAAQ,KAAK,IAAI,KAAK,MAAM,MAAM;AACrF,oBAAM,QAAQ,eAAe,MAAM,GAAG,eAAe,QAAQ,KAAK,CAAC;AACnE,oBAAM,YAAY,QAAQ,SAAS,KAAK,YAAY;AACpD;AAAA,YACJ,OAAO;AACH,oBAAM,MAAM,UAAU;AACtB,oBAAM,aAAY,WAAM,QAAQ,UAAd,YAAuB;AAAA,YAC7C;AAAA,UACJ,OAAO;AAEH,kBAAM,MAAM,UAAU;AACtB,kBAAM,aAAY,WAAM,QAAQ,UAAd,YAAuB;AAAA,UAC7C;AAAA,QACJ,CAAC;AAED,YAAI,sBAAsB,KAAK,KAAK,MAAM,SAAS,GAAG;AAClD,WAAAA,MAAA,SAAS,cAAc,mBAAmB,MAA1C,gBAAAA,IAA6C,mBAAmB,aAAa;AAAA,QACjF;AAAA,MAEJ,CAAC;AAED,gBAAU,KAAK,UAAU,SAAS,CAAC,MAAM,KAAK,gBAAgB,CAAe,CAAC;AAE9E,gBAAU,KAAK,UAAU,YAAY,MAAM;AACvC,aAAK,aAAa;AAAA,MACtB,CAAC;AAAA,IACL;AAAA,IAEQ,cAAc,qBAAmC;AAzH7D;AA2HQ,WAAK,QAAQ,UAAU,IAAI,iBAAiB;AAG5C,WAAK,SAAS,UAAU,IAAI,kBAAkB;AAG9C,WAAK,SAAS,aAAa,QAAQ,MAAM;AACzC,WAAK,SAAS,aAAa,cAAc,OAAO;AAChD,WAAK,SAAS,aAAa,eAAe,mBAAmB;AAC7D,WAAK,SAAS,aAAa,gBAAgB,KAAK;AAChD,WAAK,SAAS,aAAa,YAAY,GAAG;AAC1C,WAAK,SAAS,aAAa,QAAQ,UAAU;AAC7C,WAAK,SAAS,UAAU,IAAI,4BAA4B;AACxD,WAAK,SAAS,KAAK;AAEnB,WAAK,SAAS,YAAY,KAAK,QAAQ;AACvC,WAAK,QAAQ,YAAY,KAAK,QAAQ;AAGtC,WAAK,gBAAgB,UAAU,IAAI,kBAAkB;AACrD,WAAK,gBAAgB,MAAM,UAAU;AACrC,WAAK,cAAc,KAAK,eAAe;AACvC,WAAK,QAAQ,YAAY,KAAK,eAAe;AAE7C,iBAAK,aAAL,mBAAe,sBAAsB,YAAY,KAAK;AAAA,IAC1D;AAAA,IAEQ,cAAc,iBAAuC;AAEzD,WAAK,OAAO,QAAQ,CAAC,OAAO,UAAU;AAClC,cAAM,OAAO,SAAS,cAAc,MAAM;AAC1C,aAAK,QAAQ,QAAQ,MAAM;AAC3B,aAAK,QAAQ,QAAQ,MAAM;AAC3B,aAAK,cAAc,MAAM;AAEzB,aAAK,iBAAiB,aAAa,WAAY;AA9J3D;AA+JgB,gBAAM,eAAc,gBAAK,kBAAL,mBAAoB,aAApB,YAAgC,CAAC;AAGrD,mBAAS,IAAI,GAAG,IAAI,YAAY,QAAQ;AAAK,8BAAY,CAAC,MAAb,mBAAgB,UAAU,OAAO;AAG9E,eAAK,UAAU,IAAI,OAAO;AAAA,QAC9B,CAAC;AAED,YAAG,UAAU;AAAG,eAAK,UAAU,IAAI,OAAO;AAE1C,wBAAgB,OAAO,IAAI;AAAA,MAC/B,CAAC;AAAA,IACL;AAAA,IAEQ,eAAe;AACnB,WAAK,QAAQ,UAAU,OAAO,QAAQ;AACtC,WAAK,gBAAgB,MAAM,UAAU;AACrC,WAAK,SAAS,KAAK;AACnB,WAAK,SAAS;AACd,WAAK,SAAS,QAAQ;AAAA,IAC1B;AAAA,IAEQ,cAAc;AAClB,WAAK,QAAQ,UAAU,IAAI,QAAQ;AACnC,WAAK,gBAAgB,MAAM,UAAU;AACrC,WAAK,SAAS,MAAM;AACpB,WAAK,SAAS;AAAA,IAClB;AAAA,IAGQ,gBAAgB,QAAoB;AACxC,WAAK,YAAY;AAAA,IACrB;AAAA,IAEQ,gBAAgB,QAAoB;AACxC,aAAO,eAAe;AAEtB,UAAG,KAAK,SAAS,MAAM;AAAQ;AAE/B,UAAG,KAAK,QAAQ;AAEZ,aAAK,aAAa;AAAA,MAEtB,OAAM;AAEF,aAAK,YAAY;AAAA,MACrB;AAAA,IACJ;AAAA,EACJ;AAEA,SAAO,SAAS;AAChB,MAAO,cAAQ;","names":["_a"]}